<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Work Tracker</title>

<style>
body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    background: #0b1d2a;
    color: #fff;
}

/* ===== HEADER ===== */
header {
    padding: 20px;
    background: linear-gradient(180deg, #08151f, #0b1d2a);
}

.stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 10px;
}

.stat-box {
    background: #102a3a;
    padding: 16px;
    border-radius: 14px;
}

.stat-box h3 {
    margin: 0;
    font-size: 14px;
    opacity: 0.7;
}

.stat-box p {
    margin: 6px 0 0;
    font-size: 22px;
    font-weight: bold;
}

.stat-box input {
    margin-top: 6px;
    width: 80px;
    background: #0b1d2a;
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 6px;
}

/* ===== PROGRESS BAR ===== */
.progress-container {
    margin-top: 16px;
}

.progress-bg {
    width: 100%;
    height: 12px;
    background: #1a3446;
    border-radius: 8px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    width: 0%;
    border-radius: 8px;
    transition: width 0.4s ease, background 0.4s ease;
}

/* ===== MAIN ===== */
main {
    padding: 16px;
    max-width: 600px;
    margin: auto;
}

.section {
    margin-bottom: 26px;
}

input, select, button {
    width: 100%;
    padding: 14px;
    margin-top: 10px;
    font-size: 16px;
    border-radius: 12px;
    border: none;
}

select, input {
    background: #102a3a;
    color: #fff;
}

button {
    background: #1e90ff;
    color: #fff;
    font-weight: bold;
}

button.secondary {
    background: #102a3a;
}

button.danger {
    background: #c0392b;
}

.project-item {
    background: #102a3a;
    padding: 14px;
    border-radius: 12px;
    margin-bottom: 12px;
}
</style>
</head>

<body>

<header>
    <div class="stats">
        <div class="stat-box">
            <h3>‚è≥ Tempo rimanente</h3>
            <p id="timeRemaining">0h 0m</p>
        </div>
        <div class="stat-box">
            <h3>‚úÖ Lavoro svolto</h3>
            <p id="workDone">0h 0m</p>
        </div>
        <div class="stat-box">
            <h3>üìÖ Giorni rimanenti</h3>
            <input type="number" id="daysRemainingInput" min="0" onchange="updateDaysRemaining()">
        </div>
        <div class="stat-box">
            <h3>üïí Ore da fare oggi</h3>
            <p id="hoursPerDay">0h</p>
        </div>
    </div>

    <!-- BARRA PROGRESSO -->
    <div class="progress-container">
        <div class="progress-bg">
            <div class="progress-fill" id="progressFill"></div>
        </div>
    </div>
</header>

<main>

<div class="section">
    <select id="projectSelect" onchange="selectProjectFromDropdown()">
        <option value="">Seleziona progetto</option>
    </select>
</div>

<div class="section">
    <h2>Aggiungi lavoro</h2>
    <input id="workHoursInput" type="number" placeholder="Ore">
    <input id="workMinutesInput" type="number" placeholder="Minuti">
    <button onclick="addWork()">Aggiungi</button>
</div>

<div class="section">
    <button class="secondary" onclick="toggleNewProject()">‚öôÔ∏è Gestione progetto</button>
    <div id="newProjectSection" style="display:none; margin-top:12px;">
        <input id="projectName" placeholder="Nome progetto">
        <input id="totalHours" type="number" placeholder="Ore totali">
        <button onclick="createProject()">Crea progetto</button>
        <button class="danger" onclick="deleteCurrentProject()">Elimina progetto</button>
    </div>
</div>

</main>

<script>
let projects = [];
let currentProjectIndex = null;

/* ===== STORAGE ===== */
function saveProjects() {
    localStorage.setItem('projects', JSON.stringify(projects));
}

function loadProjects() {
    const data = localStorage.getItem('projects');
    if (data) projects = JSON.parse(data);
    renderProjectDropdown();
}

/* ===== PROGETTI ===== */
function createProject() {
    const name = projectName.value.trim();
    const hours = parseInt(totalHours.value);

    if (!name || hours <= 0) return;

    projects.push({
        name,
        totalMinutes: hours * 60,
        timeRemaining: hours * 60,
        workDone: 0,
        daysRemaining: 0
    });

    saveProjects();
    renderProjectDropdown();
    projectName.value = '';
    totalHours.value = '';
}

function renderProjectDropdown() {
    projectSelect.innerHTML = '<option value="">Seleziona progetto</option>';
    projects.forEach((p, i) => {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = p.name;
        projectSelect.appendChild(opt);
    });
}

function selectProjectFromDropdown() {
    if (projectSelect.value === '') {
        currentProjectIndex = null;
        resetDisplay();
        return;
    }
    currentProjectIndex = parseInt(projectSelect.value);
    updateDisplay();
}

/* ===== LAVORO ===== */
function addWork() {
    if (currentProjectIndex === null) return;

    const h = parseInt(workHoursInput.value) || 0;
    const m = parseInt(workMinutesInput.value) || 0;
    const total = h * 60 + m;
    if (total <= 0) return;

    const p = projects[currentProjectIndex];
    p.workDone += total;
    p.timeRemaining = Math.max(0, p.timeRemaining - total);

    saveProjects();
    updateDisplay();

    workHoursInput.value = '';
    workMinutesInput.value = '';
}

/* ===== DISPLAY ===== */
function updateDisplay() {
    const p = projects[currentProjectIndex];

    timeRemaining.textContent = formatMinutes(p.timeRemaining);
    workDone.textContent = formatMinutes(p.workDone);
    daysRemainingInput.value = p.daysRemaining;

    updateHoursPerDay();
    updateProgressBar();
}

function resetDisplay() {
    timeRemaining.textContent = '0h 0m';
    workDone.textContent = '0h 0m';
    hoursPerDay.textContent = '0h';
    daysRemainingInput.value = 0;
    progressFill.style.width = '0%';
}

/* ===== ORE AL GIORNO ===== */
function updateDaysRemaining() {
    if (currentProjectIndex === null) return;
    projects[currentProjectIndex].daysRemaining = parseInt(daysRemainingInput.value) || 0;
    saveProjects();
    updateHoursPerDay();
}

function updateHoursPerDay() {
    const p = projects[currentProjectIndex];
    if (p.timeRemaining <= 0) {
        hoursPerDay.textContent = 'Completato';
        return;
    }
    if (p.daysRemaining <= 0) {
        hoursPerDay.textContent = '‚Äî';
        return;
    }
    const h = Math.ceil((p.timeRemaining / 60) / p.daysRemaining);
    hoursPerDay.textContent = `${h}h`;
}

/* ===== PROGRESS BAR ===== */
function updateProgressBar() {
    const p = projects[currentProjectIndex];
    const percent = Math.min(100, (p.workDone / p.totalMinutes) * 100);

    progressFill.style.width = percent + '%';

    if (percent < 33) {
        progressFill.style.background = 'linear-gradient(90deg, #ff4d4d, #ff6b6b)';
    } else if (percent < 66) {
        progressFill.style.background = 'linear-gradient(90deg, #f1c40f, #f39c12)';
    } else {
        progressFill.style.background = 'linear-gradient(90deg, #2ecc71, #27ae60)';
    }
}

/* ===== UI ===== */
function toggleNewProject() {
    newProjectSection.style.display =
        newProjectSection.style.display === 'none' ? 'block' : 'none';
}

/* ===== UTILS ===== */
function formatMinutes(min) {
    return `${Math.floor(min / 60)}h ${min % 60}m`;
}

/* ===== START ===== */
loadProjects();
</script>

</body>
</html>
